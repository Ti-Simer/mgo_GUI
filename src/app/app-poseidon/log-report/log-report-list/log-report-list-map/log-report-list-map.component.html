<div class="flex justify-center">
    <div class="w-full">
        <!-- Encabezado con gradiente -->
        <div class="bg-gradient-to-r from-sky-800 to-sky-900 rounded-xl p-5 mb-6">
            <div class="flex items-center">
                <div class="bg-white/20 p-3 rounded-lg mr-4">
                    <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="text-white">
                        <path
                            d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z" />
                        <line x1="12" y1="9" x2="12" y2="13" />
                        <line x1="12" y1="17" x2="12.01" y2="17" />
                    </svg>
                </div>
                <div>
                    <h2 class="text-2xl font-bold text-white">Eventos de Ruta</h2>
                    <p class="text-sky-200 mt-1">
                        Visualización de eventos registrados durante las rutas con nivel de criticidad
                    </p>
                </div>
            </div>
            <div class="h-1 w-20 bg-sky-400 rounded-full mt-3"></div>
        </div>

        <div *ngIf="data" class="grid grid-cols-1 xl:grid-cols-2 gap-6">
            <!-- Lista de eventos -->
            <div class="bg-white rounded-2xl shadow-xl p-6">
                <div class="flex items-center mb-4">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="text-sky-600 mr-2">
                        <circle cx="12" cy="12" r="10" />
                        <polyline points="12 6 12 12 16 14" />
                    </svg>
                    <h3 class="text-xl font-semibold text-sky-800">Últimos Eventos Registrados</h3>
                </div>

                <div class="space-y-4 max-h-[600px] overflow-y-auto pr-2">
                    <div *ngFor="let item of formattedData"
                        class="bg-sky-50 border border-sky-100 rounded-xl p-4 shadow-sm cursor-pointer hover:bg-sky-100 transition-all duration-200"
                        (click)="setCenterMap(item)">
                        <div class="flex justify-between items-start">
                            <div>
                                <div class="flex items-center mb-2">
                                    <span class="font-bold text-lg text-sky-800 mr-3">{{ item.plate }}</span>
                                    <span class="px-3 py-1 text-xs font-medium bg-sky-600 text-white rounded-full">
                                        {{ item.route_event }}
                                    </span>
                                </div>
                                <p class="text-sm text-gray-600 mb-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round" class="inline mr-1">
                                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
                                        <line x1="16" y1="2" x2="16" y2="6" />
                                        <line x1="8" y1="2" x2="8" y2="6" />
                                        <line x1="3" y1="10" x2="21" y2="10" />
                                    </svg>
                                    {{ item.date | date: 'dd/MM/yyyy HH:mm' }}
                                </p>
                            </div>

                            <div class="flex flex-col items-end">
                                <!-- Indicador de criticidad -->
                                <div class="mb-2">
                                    <div *ngIf="item.criticality == 0"
                                        class="flex items-center bg-blue-50 border border-blue-100 px-3 py-1 rounded-full">
                                        <lucide-icon name="flame" [strokeWidth]="1" class="w-6 h-6 text-blue-500"></lucide-icon>
                                        <span class="text-blue-700 text-xs font-medium">Baja</span>
                                    </div>

                                    <div *ngIf="item.criticality == 1"
                                        class="flex items-center bg-yellow-50 border border-yellow-100 px-3 py-1 rounded-full">
                                        <lucide-icon name="flame" [strokeWidth]="1" class="w-6 h-6 text-orange-400"></lucide-icon>
                                        <span class="text-yellow-700 text-xs font-medium">Media</span>
                                    </div>

                                    <div *ngIf="item.criticality == 2"
                                        class="flex items-center bg-red-50 border border-red-100 px-3 py-1 rounded-full">
                                       <lucide-icon name="flame" [strokeWidth]="1" class="w-6 h-6 text-red-600"></lucide-icon>
                                        <span class="text-red-700 text-xs font-medium">Alta</span>
                                    </div>
                                </div>

                                <!-- Código del evento -->
                                <span class="px-3 py-1 text-xs font-medium bg-sky-800 text-white rounded-full">
                                    Código: {{ item.code_event }}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Mapa y leyenda -->
            <div>
                <!-- Mapa -->
                <div class="bg-white rounded-2xl shadow-xl overflow-hidden mb-6">
                    <div class="p-4 border-b border-gray-200">
                        <div class="flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" class="text-sky-600 mr-2">
                                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" />
                                <circle cx="12" cy="10" r="3" />
                            </svg>
                            <h3 class="text-xl font-semibold text-sky-800">Ubicación de Eventos</h3>
                        </div>
                    </div>

                    <div *ngIf="markers[0]?.position?.lat" class="h-[400px]">
                        <google-map [zoom]="zoom" [width]="'100%'" [height]="'100%'" [center]="mapCenter">
                            <map-marker *ngFor="let marker of markers" [position]="marker.position"
                                [label]="marker.label" [options]="{ icon: marker.icon }">
                            </map-marker>
                        </google-map>
                    </div>

                    <div *ngIf="!markers[0]?.position?.lat"
                        class="flex flex-col items-center justify-center h-[400px] bg-gray-50 p-6">
                        <svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"
                            class="text-gray-400">
                            <path
                                d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z" />
                            <line x1="12" y1="9" x2="12" y2="13" />
                            <line x1="12" y1="17" x2="12.01" y2="17" />
                        </svg>
                        <p class="text-gray-500 mt-4 text-center">Seleccione un evento para ver su ubicación en el mapa
                        </p>
                    </div>
                </div>

                <!-- Leyenda de criticidad -->
                <div class="bg-white rounded-2xl shadow-xl p-5">
                    <h3 class="text-lg font-semibold text-sky-800 mb-3 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            class="mr-2 text-sky-600">
                            <circle cx="12" cy="12" r="10" />
                            <line x1="12" y1="16" x2="12" y2="12" />
                            <line x1="12" y1="8" x2="12.01" y2="8" />
                        </svg>
                        Niveles de Criticidad
                    </h3>

                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
                        <div class="flex items-center bg-blue-50 border border-blue-100 p-3 rounded-lg">
                            <div class="w-3 h-3 rounded-full bg-blue-500 mr-4"></div>
                            <div>
                                <h4 class="font-medium text-blue-700">Baja</h4>
                                <p class="text-xs text-gray-600">Eventos de rutina o baja prioridad</p>
                            </div>
                        </div>

                        <div class="flex items-center bg-yellow-50 border border-yellow-100 p-3 rounded-lg">
                            <div class="w-3 h-3 rounded-full bg-yellow-500 mr-4"></div>
                            <div>
                                <h4 class="font-medium text-yellow-700">Media</h4>
                                <p class="text-xs text-gray-600">Requiere atención pero no urgente</p>
                            </div>
                        </div>

                        <div class="flex items-center bg-red-50 border border-red-100 p-3 rounded-lg">
                            <div class="w-3 h-3 rounded-full bg-red-500 mr-4"></div>
                            <div>
                                <h4 class="font-medium text-red-700">Alta</h4>
                                <p class="text-xs text-gray-600">Requiere atención inmediata</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sin datos -->
        <div *ngIf="formattedData.length === 0"
            class="flex flex-col items-center justify-center bg-white rounded-2xl shadow-xl p-8">
            <div class="text-center max-w-md">
                <svg xmlns="http://www.w3.org/2000/svg" width="120" height="120" viewBox="0 0 520 472"
                    class="mx-auto text-gray-400">
                    <g fill="currentColor">
                        <path
                            d="M990 4561 c-194 -28 -404 -164 -519 -337 -101 -151 -138 -304 -121 -510 20 -260 237 -730 566 -1226 115 -173 149 -208 198 -208 46 0 76 27 150 133 342 492 587 1010 617 1305 46 446 -285 830 -729 847 -59 2 -132 0 -162 -4z m312 -378 c72 -34 144 -94 188 -158 42 -61 80 -177 80 -244 0 -167 -106 -331 -265 -411 -68 -34 -73 -35 -190 -35 -119 0 -120 0 -194 39 -126 64 -205 160 -245 295 -64 216 77 461 309 538 25 8 78 12 145 10 94 -2 112 -6 172 -34z" />
                        <path
                            d="M4885 4025 c-27 -7 -88 -24 -135 -38 -150 -45 -333 -99 -410 -122 -41 -12 -115 -34 -165 -49 -88 -27 -174 -52 -338 -100 -45 -13 -138 -41 -207 -61 -249 -75 -257 -76 -405 -30 -86 26 -225 68 -370 110 -49 14 -117 34 -150 45 -33 10 -116 34 -185 55 -153 45 -271 80 -370 111 -116 37 -180 28 -180 -24 0 -51 30 -65 365 -162 61 -17 144 -42 185 -55 41 -13 125 -38 185 -55 61 -17 137 -40 170 -50 33 -10 116 -35 185 -55 237 -69 245 -75 254 -178 4 -34 11 -222 16 -417 14 -482 28 -808 41 -910 10 -82 14 -98 23 -89 14 14 27 324 36 862 11 677 8 644 78 674 20 9 66 24 102 34 36 10 112 32 170 49 58 18 142 43 188 56 89 26 200 59 327 97 44 13 136 41 205 62 129 39 208 62 342 98 l78 22 22 -23 23 -23 0 -1512 c0 -1405 -1 -1515 -17 -1539 -17 -26 -82 -50 -328 -122 -47 -13 -155 -46 -240 -72 -85 -25 -191 -57 -235 -69 -44 -13 -143 -42 -220 -65 -448 -133 -443 -132 -464 -121 -27 15 -30 27 -41 175 -9 121 -22 168 -42 148 -7 -7 -20 -91 -34 -224 -6 -61 -33 -108 -63 -108 -10 0 -37 6 -62 14 -24 8 -100 31 -169 51 -69 20 -152 45 -185 55 -33 10 -109 33 -170 50 -60 17 -144 42 -185 55 -76 23 -153 46 -355 105 -237 70 -295 91 -311 115 -9 14 -20 67 -25 130 -6 59 -15 119 -20 133 -18 46 -38 6 -54 -108 -8 -58 -22 -120 -31 -137 -22 -42 -65 -58 -414 -159 -47 -13 -130 -38 -185 -55 -55 -17 -125 -37 -155 -45 -30 -8 -89 -26 -130 -39 -41 -13 -113 -35 -160 -49 -397 -118 -412 -121 -430 -87 -15 29 -14 3035 1 3064 6 12 19 31 29 42 30 34 33 62 11 84 -41 41 -126 18 -158 -42 -17 -30 -18 -122 -18 -1644 l0 -1612 21 -27 c38 -52 58 -51 247 6 288 87 456 137 642 190 61 17 129 38 152 46 23 8 79 26 125 38 46 13 124 36 173 50 50 15 140 41 200 57 l110 31 80 -22 c85 -23 201 -57 325 -95 41 -13 125 -38 185 -55 61 -17 144 -42 185 -55 41 -13 125 -38 185 -55 61 -18 137 -40 170 -50 33 -10 110 -33 170 -50 61 -17 144 -43 185 -56 94 -30 139 -30 237 0 43 13 128 38 188 56 61 17 137 40 170 50 33 10 110 32 170 50 61 18 144 43 185 55 41 13 125 37 185 55 61 18 144 43 185 55 41 13 125 38 185 55 233 68 280 85 302 106 l23 23 0 1621 c0 1729 2 1666 -45 1684 -26 10 -105 5 -160 -9z" />
                        <path
                            d="M1751 3091 c-20 -37 -23 -101 -12 -297 16 -272 35 -378 55 -298 21 81 33 562 16 595 -14 24 -46 25 -59 0z" />
                        <path
                            d="M4125 2780 c-228 -45 -383 -199 -415 -410 -30 -195 87 -497 343 -885 127 -193 153 -186 321 86 112 181 205 366 253 500 34 97 36 112 37 224 1 119 1 121 -36 198 -71 149 -198 247 -363 282 -77 16 -82 16 -140 5z m170 -244 c50 -21 113 -84 143 -140 112 -220 -144 -477 -363 -364 -198 102 -222 342 -49 474 68 52 184 65 269 30z" />
                        <path
                            d="M1090 2060 c-24 -24 -25 -62 -5 -121 25 -71 70 -91 101 -44 14 21 15 34 5 86 -16 93 -56 124 -101 79z" />
                        <path
                            d="M2272 1744 c-32 -22 -27 -74 8 -91 51 -26 164 -12 176 22 10 26 -5 61 -31 73 -38 17 -126 15 -153 -4z" />
                        <path
                            d="M1328 1655 c-15 -33 10 -71 65 -96 56 -25 99 -24 123 2 17 18 17 23 4 47 -19 35 -93 72 -142 72 -31 0 -41 -5 -50 -25z" />
                        <path
                            d="M1849 1643 c-43 -22 -55 -34 -57 -55 -2 -20 4 -31 23 -44 23 -15 33 -16 82 -4 90 20 131 79 81 114 -32 23 -67 20 -129 -11z" />
                        <path
                            d="M2725 1606 c-21 -32 -5 -67 47 -101 52 -34 90 -41 111 -20 27 27 21 60 -19 95 -63 55 -114 65 -139 26z" />
                        <path d="M3102 1318 c-23 -23 -13 -59 26 -99 57 -56 132 -66 147 -18 19 60 -129 161 -173 117z" />
                        <path
                            d="M4063 1179 c-32 -9 -63 -42 -63 -66 0 -22 39 -53 66 -53 40 0 101 21 124 42 25 24 26 64 1 78 -24 12 -84 12 -128 -1z" />
                        <path
                            d="M3551 1133 c-18 -15 -23 -26 -18 -45 8 -32 45 -48 108 -48 62 0 89 13 89 44 0 36 -32 57 -97 63 -48 4 -62 2 -82 -14z" />
                    </g>
                </svg>
                <h3 class="text-2xl font-semibold text-gray-700 mt-4">No hay eventos disponibles</h3>
                <p class="text-gray-500 mt-2">
                    Actualmente no se han registrado eventos de ruta. Los eventos aparecerán aquí cuando estén
                    disponibles.
                </p>
            </div>
        </div>
    </div>
</div>